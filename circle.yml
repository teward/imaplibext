machine:
  python:
    version: 2.7.10
dependencies:
  pre:
    - if [ $CIRCLE_NODE_INDEX == "1" ] ; then pyenv global 3.6.1 ; fi
  cache_directories:
    - "~/virtualenvs"
    - "~/.cache/pip"
  override:
    - case $CIRCLE_NODE_INDEX in 0) pyenv local 2.7.10 --upgrade ;; 1) pyenv 3.6.1 ;; esac
    - case $CIRCLE_NODE_INDEX in 0) pip install flake8 --upgrade ;; 1) pip3 install flake8 --upgrade ;; esac
    - case $CIRCLE_NODE_INDEX in 0) pip install -r requirements.txt --upgrade ;; 1) pip3 install -r requirements.txt --upgrade ;; esac
test:
  override:
      - case $CIRCLE_NODE_INDEX in 0) flake8 . ;; 1) flake8 . ;; esac:
          parallel: true
      - case $CIRCLE_NODE_INDEX in 0) python -m unittest -v tests ;; 1) python3 -m unittest -v tests ;; esac:
          parallel: true